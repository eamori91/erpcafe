# ğŸ“± AgroFinca CafÃ© - AplicaciÃ³n MÃ³vil Especializada

## ğŸ¯ ESPECIFICACIONES TÃ‰CNICAS

### CaracterÃ­sticas Principales
- **Offline-first**: Funciona sin conexiÃ³n en el campo
- **GeolocalizaciÃ³n**: GPS automÃ¡tico para cada registro
- **CÃ³digos QR**: IdentificaciÃ³n rÃ¡pida de cuerdas y empleados
- **CÃ¡mara integrada**: Evidencia fotogrÃ¡fica de actividades
- **SincronizaciÃ³n inteligente**: Datos siempre actualizados

## ğŸ“‹ FUNCIONALIDADES ESPECÃFICAS PARA CAFÃ‰

### ğŸŒ± MÃ³dulo de RecolecciÃ³n
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“± REGISTRO DE RECOLECCIÃ“N         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Empleado: [Juan PÃ©rez â–¼]           â”‚
â”‚ Cuerda: [Escanear QR] [A-01 â–¼]     â”‚
â”‚ Variedad: [Caturra]                â”‚
â”‚ Libras: [____] âš–ï¸                  â”‚
â”‚ Calidad: [â­â­â­â­â­]               â”‚
â”‚ Foto: [ğŸ“· Capturar]                â”‚
â”‚ Estado: [ğŸŸ¢ Maduro Ã³ptimo]         â”‚
â”‚                                     â”‚
â”‚ [ğŸ’¾ Guardar] [ğŸ“¤ Sincronizar]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### âš—ï¸ MÃ³dulo de Beneficiado
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ§ª CONTROL DE FERMENTACIÃ“N        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Pileta: [P-03 â–¼]                   â”‚
â”‚ Lote: [2025-07-29-A-01]            â”‚
â”‚ Entrada: [500] lbs                 â”‚
â”‚ pH Inicial: [6.2]                  â”‚
â”‚ Temp: [25Â°C] ğŸŒ¡ï¸                   â”‚
â”‚ Estado: [ğŸ”„ En proceso]            â”‚
â”‚ Timer: [â° 14:30:22]               â”‚
â”‚                                     â”‚
â”‚ [ğŸ“¸ Foto] [â¹ï¸ Finalizar]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ‘¥ MÃ³dulo de Personal
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘¤ GESTIÃ“N DE EMPLEADOS           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Asistencia Hoy: 23/25 âœ…           â”‚
â”‚                                     â”‚
â”‚ ğŸŸ¢ Juan PÃ©rez    | 45 lbs | Q56.25 â”‚
â”‚ ğŸŸ¢ MarÃ­a LÃ³pez   | 52 lbs | Q65.00 â”‚
â”‚ ğŸ”´ Carlos Ruiz   | Ausente         â”‚
â”‚                                     â”‚
â”‚ Adelantos Pendientes: Q450         â”‚
â”‚ Pago Quincenal: En 3 dÃ­as         â”‚
â”‚                                     â”‚
â”‚ [â• Nuevo Adelanto] [ğŸ“Š Reportes]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ ARQUITECTURA TÃ‰CNICA

### Framework: Flutter (Multiplataforma)
```yaml
dependencies:
  flutter: ^3.13.0
  sqflite: ^2.3.0      # Base de datos local
  geolocator: ^9.0.2   # GPS
  camera: ^0.10.5      # CÃ¡mara
  qr_code_scanner: ^1.0.1  # QR Scanner
  dio: ^5.3.2          # HTTP Client
  hive: ^2.2.3         # Cache local
```

### Base de Datos Local (SQLite)
```sql
-- Tabla para actividades offline
CREATE TABLE actividades_campo (
    id INTEGER PRIMARY KEY,
    empleado_id TEXT,
    cuerda_id TEXT,
    fecha TEXT,
    tipo_trabajo TEXT,
    cantidad REAL,
    tarifa REAL,
    pago_calculado REAL,
    foto_path TEXT,
    gps_lat REAL,
    gps_lon REAL,
    sincronizado INTEGER DEFAULT 0,
    timestamp_creacion TEXT
);

-- Tabla para empleados (cache)
CREATE TABLE empleados (
    id TEXT PRIMARY KEY,
    nombre TEXT,
    codigo_empleado TEXT,
    activo INTEGER DEFAULT 1,
    ultima_sync TEXT
);

-- Tabla para cuerdas (cache)
CREATE TABLE cuerdas (
    id TEXT PRIMARY KEY,
    codigo TEXT,
    variedad_cafe TEXT,
    area_hectareas REAL,
    qr_code TEXT,
    ultima_sync TEXT
);
```

### API Integration con ERPNext
```dart
class ERPNextAPI {
  static const String baseUrl = 'https://tu-erpnext.com';
  
  // Sincronizar actividades pendientes
  Future<bool> syncActividades() async {
    final pendientes = await db.getActividadesPendientes();
    
    for (var actividad in pendientes) {
      try {
        final response = await dio.post(
          '$baseUrl/api/resource/Actividad de Campo',
          data: {
            'empleado': actividad.empleadoId,
            'unidad_trabajo': actividad.cuerdaId,
            'fecha': actividad.fecha,
            'tipo_trabajo': actividad.tipoTrabajo,
            'cantidad': actividad.cantidad,
            'tarifa_unidad': actividad.tarifa,
            'pago_generado': actividad.pagoCalculado,
          },
        );
        
        if (response.statusCode == 200) {
          await db.marcarSincronizado(actividad.id);
        }
      } catch (e) {
        print('Error sincronizando: $e');
      }
    }
    
    return true;
  }
  
  // Descargar datos maestros
  Future<void> downloadMaestros() async {
    // Empleados
    final empleados = await dio.get(
      '$baseUrl/api/resource/Employee',
      queryParameters: {'filters': '[["status", "=", "Active"]]'}
    );
    await db.insertEmpleados(empleados.data);
    
    // Cuerdas
    final cuerdas = await dio.get(
      '$baseUrl/api/resource/Unidad de Trabajo'
    );
    await db.insertCuerdas(cuerdas.data);
  }
}
```

## ğŸ“¦ DISTRIBUCIÃ“N Y DEPLOYMENT

### Android (Play Store Internal)
```yaml
# android/app/build.gradle
android {
    compileSdkVersion 34
    
    defaultConfig {
        applicationId "com.finca.agrocafe"
        minSdkVersion 21
        targetSdkVersion 34
        versionCode 1
        versionName "1.0.0"
    }
    
    buildTypes {
        release {
            signingConfig signingConfigs.release
            minifyEnabled true
        }
    }
}
```

### iOS (TestFlight)
```yaml
# ios/Runner/Info.plist
<key>NSLocationWhenInUseUsageDescription</key>
<string>Necesario para registrar ubicaciÃ³n de actividades</string>
<key>NSCameraUsageDescription</key>
<string>Tomar fotos de evidencia de trabajo</string>
```

## ğŸ“± MOCKUPS DE PANTALLAS

### Pantalla Principal
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ ğŸŒ± AgroFinca CafÃ©        ğŸ“¶ğŸ”‹100%    â•‘
â•‘                                       â•‘
â•‘  Bienvenido, Juan PÃ©rez               â•‘
â•‘  ğŸ“ Finca La Esperanza                â•‘
â•‘  ğŸ“… Lunes, 29 Julio 2025              â•‘
â•‘                                       â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘  â”‚  ğŸŒ± RECOLECCIÃ“N          [45]   â”‚   â•‘
â•‘  â”‚  Registrar cosecha diaria       â”‚   â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•‘                                       â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘  â”‚  âš—ï¸ BENEFICIADO          [3]    â”‚   â•‘
â•‘  â”‚  Control de procesos            â”‚   â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•‘                                       â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘  â”‚  ğŸ‘¥ PERSONAL             [23]   â”‚   â•‘
â•‘  â”‚  Asistencia y pagos             â”‚   â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•‘                                       â•‘
â•‘  [ğŸ“Š Reportes] [âš™ï¸ Config] [ğŸ“¤ Sync]  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Formulario de RecolecciÃ³n
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ â† ğŸŒ± NUEVA RECOLECCIÃ“N                â•‘
â•‘                                       â•‘
â•‘  Trabajador: Juan PÃ©rez âœ“             â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘  â”‚ ğŸ“·                  ğŸ“ GPS OK   â”‚   â•‘
â•‘  â”‚                                 â”‚   â•‘
â•‘  â”‚   [Foto del cafÃ© recolectado]   â”‚   â•‘
â•‘  â”‚                                 â”‚   â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•‘                                       â•‘
â•‘  Cuerda: [ğŸ“± Escanear QR] A-01        â•‘
â•‘  Variedad: Caturra                    â•‘
â•‘                                       â•‘
â•‘  Libras: [_____45_____] âš–ï¸            â•‘
â•‘         â””â”€ Deslizar para ajustar â”€â”˜   â•‘
â•‘                                       â•‘
â•‘  Calidad: â­â­â­â­â­ (Excelente)       â•‘
â•‘                                       â•‘
â•‘  ğŸ’° Pago calculado: Q56.25            â•‘
â•‘                                       â•‘
â•‘  [âŒ Cancelar]    [âœ… GUARDAR]        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## ğŸ” SEGURIDAD Y OFFLINE

### Estrategia Offline-First
```dart
class OfflineManager {
  // Guardar actividad offline
  Future<void> saveActivityOffline(Actividad actividad) async {
    actividad.sincronizado = false;
    actividad.timestampCreacion = DateTime.now().toIso8601String();
    
    await db.insertActividad(actividad);
    
    // Intentar sync inmediato si hay conexiÃ³n
    if (await NetworkUtils.hasConnection()) {
      await ERPNextAPI().syncActividades();
    }
  }
  
  // Resolver conflictos de sincronizaciÃ³n
  Future<void> resolveConflicts() async {
    final conflictos = await db.getConflictos();
    
    for (var conflicto in conflictos) {
      // Estrategia: el timestamp mÃ¡s reciente gana
      if (conflicto.timestampLocal.isAfter(conflicto.timestampServidor)) {
        await ERPNextAPI().updateActividad(conflicto);
      } else {
        await db.updateFromServer(conflicto);
      }
    }
  }
}
```

## ğŸ“Š MÃ‰TRICAS Y ANALYTICS

### Dashboard en la App
```dart
class DashboardScreen extends StatelessWidget {
  Widget build(BuildContext context) {
    return Column(
      children: [
        // KPIs del dÃ­a
        Row(
          children: [
            MetricCard(
              title: "Hoy",
              value: "245 lbs",
              icon: Icons.coffee,
              color: Colors.brown,
            ),
            MetricCard(
              title: "Esta semana", 
              value: "1,850 lbs",
              icon: Icons.trending_up,
              color: Colors.green,
            ),
          ],
        ),
        
        // GrÃ¡fico de productividad
        Container(
          height: 200,
          child: LineChart(
            // Datos de los Ãºltimos 7 dÃ­as
            productividadSemanal,
          ),
        ),
        
        // Lista de actividades recientes
        Expanded(
          child: ListView.builder(
            itemBuilder: (context, index) {
              return ActividadCard(actividades[index]);
            },
          ),
        ),
      ],
    );
  }
}
```

Esta app mÃ³vil se integra perfectamente con el sistema ERPNext que ya creamos, proporcionando una interfaz intuitiva y robusta para el trabajo de campo.
